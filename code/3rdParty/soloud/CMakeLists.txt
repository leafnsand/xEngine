# default option values
set(soloud_winmm_default 0)
set(soloud_wasapi_default 0)
set(soloud_xaudio2_default 0)
set(soloud_coreaudio_default 0)
set(soloud_openal_default 0)
set(soloud_opensles_default 0)
set(soloud_alsa_default 0)
set(soloud_sdlstatic_default 0)
set(soloud_tools_default 0)
set(soloud_null_default 0)
if (FIPS_WINDOWS)
    set(soloud_winmm_default 1)
endif()
if (FIPS_OSX OR FIPS_IOS)
    set(soloud_coreaudio_default 1)
endif()
if (FIPS_EMSCRIPTEN)
    set(soloud_sdlstatic_default 1)
elseif (FIPS_PNACL)
    set(soloud_null_default 1)
elseif (FIPS_ANDROID)
    set(soloud_opensles_default 1)
elseif (FIPS_LINUX)
    set(soloud_alsa_default 1)
endif()
if (FIPS_PNACL)
    set(soloud_modplug_default 0)
else()
    set(soloud_modplug_default 1)
endif()
if (NOT FIPS_IMPORT)
    set(soloud_tools_default 1)
endif()

# backend options
option(SOLOUD_SDL "Compile soloud with SDL backend" OFF)
option(SOLOUD_SDL_STATIC "Compile soloud with static SDL backend" ${soloud_sdlstatic_default})
option(SOLOUD_SDL2_STATIC "Compile soloud with static SDL2 backend" OFF)
option(SOLOUD_PORTAUDIO "Compile soloud with PortAudio backend" OFF)
option(SOLOUD_OPENAL "Compile soloud with OpenAL backend" ${soloud_openal_default})
option(SOLOUD_OPENSLES "Compile soloud with OpenSLES backend" ${soloud_opensles_default})
option(SOLOUD_XAUDIO2 "Compile soloud with XAudio2 backend" ${soloud_xaudio2_default})
option(SOLOUD_WINMM "Compile soloud with WinMM backend" ${soloud_winmm_default})
option(SOLOUD_WASAPI "Compile soloud with WASAPI backend" ${soloud_wasapi_default})
option(SOLOUD_ALSA "Compile soloud with ALSA backend" ${soloud_alsa_default})
option(SOLOUD_OSS "Compile soloud with OSS backend" OFF)
option(SOLOUD_COREAUDIO "Compile soloud with CoreAudio backend" ${soloud_coreaudio_default})
option(SOLOUD_NULL "Compile soloud with NULL backend" ${soloud_null_default})
option(SOLOUD_LIBMODPLUG "Add libmodplug support to soloud" ${soloud_modplug_default})
option(SOLOUD_PORTMIDI "Add portmidi support to soloud" OFF)
option(SOLOUD_TOOLS "Compile soloud tools" ${soloud_tools_default})

fips_begin_module(soloud)
    fips_src(src/audiosource/modplug GROUP audiosource)
    fips_src(src/audiosource/monotone GROUP audiosource)
    fips_src(src/audiosource/sfxr GROUP audiosource)
    fips_src(src/audiosource/speech GROUP audiosource)
    fips_src(src/audiosource/tedsid GROUP audiosource)
    fips_src(src/audiosource/vic GROUP audiosource)
    fips_src(src/audiosource/wav GROUP audiosource)
    fips_src(src/filter GROUP filter)
    fips_src(src/core GROUP core)
    fips_src(include GROUP include)
    if (SOLOUD_OPENAL) 
        fips_src(src/backend/openal GROUP openal)
    endif()
    if (SOLOUD_OPENSLES)
        fips_src(src/backend/opensles GROUP opensles)
        fips_libs(OpenSLES)
    endif()
    if (SOLOUD_ALSA)
        fips_src(src/backend/alsa GROUP alsa)
        fips_libs(asound)
    endif()
    if (SOLOUD_OSS)
        fips_src(src/backend/oss GROUP oss)
    endif()
    if (SOLOUD_COREAUDIO)
        fips_src(src/backend/coreaudio GROUP coreaudio)
        fips_frameworks_osx(AudioToolbox)
    endif()
    if (SOLOUD_PORTAUDIO)
        fips_src(src/backend/portaudio GROUP portaudio)
    endif()
    if (SOLOUD_SDL)
        fips_src(src/backend/sdl GROUP sdl)
    endif()
    if (SOLOUD_SDL_STATIC)
        fips_src(src/backend/sdl_static GROUP sdl_static)
    endif()
    if (SOLOUD_SDL2_STATIC)
        fips_src(src/backend/sdl2_static GROUP sdl2_static)
    endif()
    if (SOLOUD_WASAPI)
        fips_src(src/backend/wasapi GROUP wasapi)
    endif()
    if (SOLOUD_XAUDIO2)
        fips_src(src/backend/xaudio2 GROUP xaudio2)
    endif()
    if (SOLOUD_WINMM)
        fips_src(src/backend/winmm GROUP winmm)
    endif()
    if (SOLOUD_NULL)
        fips_src(src/backend/null GROUP null)
    endif()
fips_end_module()
target_include_directories(soloud PUBLIC include)

# configuration defines need only be visible in the implementation files
if (SOLOUD_OPENAL) 
    target_compile_definitions(soloud PRIVATE WITH_OPENAL=1)
endif()
if (SOLOUD_OPENSLES)
    target_compile_definitions(soloud PRIVATE WITH_OPENSLES=1)
endif()
if (SOLOUD_ALSA)
    target_compile_definitions(soloud PRIVATE WITH_ALSA=1)
endif()
if (SOLOUD_OSS)
    target_compile_definitions(soloud PRIVATE WITH_OSS=1)
endif()
if (SOLOUD_COREAUDIO)
    target_compile_definitions(soloud PRIVATE WITH_COREAUDIO=1)
endif()
if (SOLOUD_PORTAUDIO)
    target_compile_definitions(soloud PRIVATE WITH_PORTAUDIO=1)
endif()
if (SOLOUD_SDL)
    target_compile_definitions(soloud PRIVATE WITH_SDL=1)
endif()
if (SOLOUD_SDL_STATIC)
    target_compile_definitions(soloud PRIVATE WITH_SDL_STATIC=1)
endif()
if (SOLOUD_SDL2_STATIC)
    target_compile_definitions(soloud PRIVATE WITH_SDL2_STATIC=1)
endif()
if (SOLOUD_WASAPI)
    target_compile_definitions(soloud PRIVATE WITH_WASAPI=1)
endif()
if (SOLOUD_XAUDIO2)
    target_compile_definitions(soloud PRIVATE WITH_XAUDIO2=1)
endif()
if (SOLOUD_WINMM)
    target_compile_definitions(soloud PRIVATE WITH_WINMM=1)
endif()
if (SOLOUD_NULL)
    target_compile_definitions(soloud PRIVATE WITH_NULL=1)
endif()

set(args)
if (FIPS_CLANG)
    set(args -Wno-unused-function -Wno-unused-private-field -Wno-dangling-else -Wno-missing-braces -Wno-unused-value -Wno-parentheses -Wno-sign-compare -Wno-unused-variable -Wno-deprecated-register -Wno-writable-strings -Wno-reorder -Wno-delete-non-virtual-dtor -Wno-deprecated-register -Wno-missing-braces -Wno-unused-function -Wno-unused-variable)
elseif (FIPS_GCC)
    set(args -Wno-unused-function -Wno-missing-braces -Wno-unused-value -Wno-parentheses -Wno-sign-compare -Wno-unused-variable -Wno-reorder -Wno-delete-non-virtual-dtor -Wno-maybe-uninitialized -Wno-unused-but-set-variable -Wno-unused-result)
elseif (FIPS_WINDOWS)
    # 4814: he file contains a character that cannot be represented in the current code page...
    set(args /wd4819)
elseif (FIPS_UWP)
    # 4146: unary minus operator applied to unsigned type, result still unsigned
    # 4244: conversion from __int64 to int, possible loss of data
    set(args /wd4146 /wd4244)
endif()
if (args)
    target_compile_options(soloud PRIVATE ${args})
endif()